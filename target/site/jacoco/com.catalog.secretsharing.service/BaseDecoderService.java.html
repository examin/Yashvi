<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>BaseDecoderService.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">shamir-secret-sharing</a> &gt; <a href="index.source.html" class="el_package">com.catalog.secretsharing.service</a> &gt; <span class="el_source">BaseDecoderService.java</span></div><h1>BaseDecoderService.java</h1><pre class="source lang-java linenums">package com.catalog.secretsharing.service;

import com.catalog.secretsharing.model.RootPoint;
import org.springframework.stereotype.Service;
import lombok.extern.slf4j.Slf4j;

import java.math.BigInteger;
import java.util.HashMap;
import java.util.Map;

/**
 * Service for decoding y-values from different number bases to decimal
 * 
 * This service handles the conversion of encoded values from various bases (2-36)
 * to decimal representation using BigInteger for handling large numbers.
 */
@Service
<span class="fc" id="L18">@Slf4j</span>
<span class="nc" id="L19">public class BaseDecoderService {</span>
    
    /**
     * Cache for frequently used conversions to improve performance
     */
<span class="nc" id="L24">    private final Map&lt;String, String&gt; conversionCache = new HashMap&lt;&gt;();</span>
    
    /**
     * Decodes a value from the specified base to decimal representation
     * 
     * @param value the encoded value
     * @param base the source base (2-36)
     * @return the decoded value as a string (decimal representation)
     * @throws IllegalArgumentException if base is invalid or value is invalid for the base
     */
    public String decodeValue(String value, String base) {
<span class="nc" id="L35">        validateInputs(value, base);</span>
        
        // Check cache first
<span class="nc" id="L38">        String cacheKey = value + &quot;:&quot; + base;</span>
<span class="nc bnc" id="L39" title="All 2 branches missed.">        if (conversionCache.containsKey(cacheKey)) {</span>
<span class="nc" id="L40">            log.debug(&quot;Cache hit for conversion: {} from base {}&quot;, value, base);</span>
<span class="nc" id="L41">            return conversionCache.get(cacheKey);</span>
        }
        
        try {
<span class="nc" id="L45">            int baseInt = Integer.parseInt(base);</span>
            
            // Validate base range
<span class="nc bnc" id="L48" title="All 4 branches missed.">            if (baseInt &lt; 2 || baseInt &gt; 36) {</span>
<span class="nc" id="L49">                throw new IllegalArgumentException(&quot;Base must be between 2 and 36, got: &quot; + baseInt);</span>
            }
            
            // Validate value for the base
<span class="nc" id="L53">            validateValueForBase(value, baseInt);</span>
            
            // Convert using BigInteger to handle large numbers
<span class="nc" id="L56">            BigInteger result = new BigInteger(value.toUpperCase(), baseInt);</span>
<span class="nc" id="L57">            String decodedValue = result.toString();</span>
            
            // Cache the result
<span class="nc" id="L60">            conversionCache.put(cacheKey, decodedValue);</span>
            
<span class="nc" id="L62">            log.debug(&quot;Decoded '{}' from base {} to decimal: {}&quot;, value, base, decodedValue);</span>
<span class="nc" id="L63">            return decodedValue;</span>
            
<span class="nc" id="L65">        } catch (NumberFormatException e) {</span>
<span class="nc" id="L66">            throw new IllegalArgumentException(</span>
<span class="nc" id="L67">                String.format(&quot;Failed to decode value '%s' from base %s: %s&quot;, </span>
<span class="nc" id="L68">                            value, base, e.getMessage()), e);</span>
        }
    }
    
    /**
     * Decodes a RootPoint, setting its decodedY value
     * 
     * @param rootPoint the root point to decode
     * @return the same root point with decodedY set
     */
    public RootPoint decodeRootPoint(RootPoint rootPoint) {
<span class="nc bnc" id="L79" title="All 2 branches missed.">        if (rootPoint == null) {</span>
<span class="nc" id="L80">            throw new IllegalArgumentException(&quot;RootPoint cannot be null&quot;);</span>
        }
        
<span class="nc" id="L83">        String decodedValue = decodeValue(rootPoint.getValue(), rootPoint.getBase());</span>
<span class="nc" id="L84">        rootPoint.setDecodedY(decodedValue);</span>
        
<span class="nc" id="L86">        log.debug(&quot;Decoded root point: x={}, originalValue={}, base={}, decodedY={}&quot;, </span>
<span class="nc" id="L87">                rootPoint.getX(), rootPoint.getValue(), rootPoint.getBase(), decodedValue);</span>
        
<span class="nc" id="L89">        return rootPoint;</span>
    }
    
    /**
     * Validates input parameters
     */
    private void validateInputs(String value, String base) {
<span class="nc bnc" id="L96" title="All 4 branches missed.">        if (value == null || value.trim().isEmpty()) {</span>
<span class="nc" id="L97">            throw new IllegalArgumentException(&quot;Value cannot be null or empty&quot;);</span>
        }
        
<span class="nc bnc" id="L100" title="All 4 branches missed.">        if (base == null || base.trim().isEmpty()) {</span>
<span class="nc" id="L101">            throw new IllegalArgumentException(&quot;Base cannot be null or empty&quot;);</span>
        }
        
        try {
<span class="nc" id="L105">            Integer.parseInt(base);</span>
<span class="nc" id="L106">        } catch (NumberFormatException e) {</span>
<span class="nc" id="L107">            throw new IllegalArgumentException(&quot;Base must be a valid integer: &quot; + base);</span>
<span class="nc" id="L108">        }</span>
<span class="nc" id="L109">    }</span>
    
    /**
     * Validates that all characters in the value are valid for the given base
     * 
     * @param value the value to validate
     * @param base the base to validate against
     */
    private void validateValueForBase(String value, int base) {
<span class="nc" id="L118">        String upperValue = value.toUpperCase();</span>
        
<span class="nc bnc" id="L120" title="All 2 branches missed.">        for (int i = 0; i &lt; upperValue.length(); i++) {</span>
<span class="nc" id="L121">            char c = upperValue.charAt(i);</span>
            int digitValue;
            
<span class="nc bnc" id="L124" title="All 2 branches missed.">            if (Character.isDigit(c)) {</span>
<span class="nc" id="L125">                digitValue = c - '0';</span>
<span class="nc bnc" id="L126" title="All 6 branches missed.">            } else if (Character.isLetter(c) &amp;&amp; c &gt;= 'A' &amp;&amp; c &lt;= 'Z') {</span>
<span class="nc" id="L127">                digitValue = c - 'A' + 10;</span>
            } else {
<span class="nc" id="L129">                throw new IllegalArgumentException(</span>
<span class="nc" id="L130">                    String.format(&quot;Invalid character '%c' at position %d in value '%s' for base %d&quot;, </span>
<span class="nc" id="L131">                                c, i, value, base));</span>
            }
            
<span class="nc bnc" id="L134" title="All 2 branches missed.">            if (digitValue &gt;= base) {</span>
<span class="nc" id="L135">                throw new IllegalArgumentException(</span>
<span class="nc" id="L136">                    String.format(&quot;Character '%c' (value %d) is invalid for base %d in value '%s'&quot;, </span>
<span class="nc" id="L137">                                c, digitValue, base, value));</span>
            }
        }
<span class="nc" id="L140">    }</span>
    
    /**
     * Converts a decimal string back to a specified base (for testing/verification)
     * 
     * @param decimalValue the decimal value as string
     * @param targetBase the target base (2-36)
     * @return the value in the target base
     */
    public String encodeToBase(String decimalValue, int targetBase) {
<span class="nc bnc" id="L150" title="All 4 branches missed.">        if (targetBase &lt; 2 || targetBase &gt; 36) {</span>
<span class="nc" id="L151">            throw new IllegalArgumentException(&quot;Base must be between 2 and 36&quot;);</span>
        }
        
        try {
<span class="nc" id="L155">            BigInteger value = new BigInteger(decimalValue);</span>
<span class="nc" id="L156">            return value.toString(targetBase).toUpperCase();</span>
<span class="nc" id="L157">        } catch (NumberFormatException e) {</span>
<span class="nc" id="L158">            throw new IllegalArgumentException(&quot;Invalid decimal value: &quot; + decimalValue, e);</span>
        }
    }
    
    /**
     * Gets the size of the conversion cache (for monitoring)
     * 
     * @return cache size
     */
    public int getCacheSize() {
<span class="nc" id="L168">        return conversionCache.size();</span>
    }
    
    /**
     * Clears the conversion cache
     */
    public void clearCache() {
<span class="nc" id="L175">        conversionCache.clear();</span>
<span class="nc" id="L176">        log.info(&quot;Conversion cache cleared&quot;);</span>
<span class="nc" id="L177">    }</span>
    
    /**
     * Gets supported base range information
     * 
     * @return map with min and max supported bases
     */
    public Map&lt;String, Integer&gt; getSupportedBaseRange() {
<span class="nc" id="L185">        Map&lt;String, Integer&gt; range = new HashMap&lt;&gt;();</span>
<span class="nc" id="L186">        range.put(&quot;minBase&quot;, 2);</span>
<span class="nc" id="L187">        range.put(&quot;maxBase&quot;, 36);</span>
<span class="nc" id="L188">        return range;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>